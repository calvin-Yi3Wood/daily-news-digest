# 📋 定时推送故障诊断报告

**生成时间**: 2025-12-02
**问题**: 自动推送已停止约一周

---

## 🔍 问题分析

根据项目配置分析，定时推送系统应该在每天 **北京时间07:55**（UTC 23:55）自动执行。
系统停止工作的可能原因有以下几个：

### 原因1: GitHub Actions被禁用或暂停 ⚠️ **最可能**

**症状**:
- Actions标签页可能显示"Actions已禁用"
- 或者没有任何近期运行记录

**检查方法**:
1. 访问GitHub仓库: https://github.com/calvin-Yi3Wood/daily-news-digest
2. 点击顶部的 **Actions** 标签
3. 查看是否显示禁用状态或近期运行记录

**解决方法**:
如果Actions被禁用，点击 **"I understand my workflows, go ahead and enable them"** 启用

---

### 原因2: GitHub Secrets过期或失效 🔑

**症状**:
- Actions运行失败（显示红色×）
- 日志中显示认证错误或API调用失败

**需要检查的Secrets**:
- `GLM_API_KEY` - 智谱AI API密钥
- `WECHAT_WEBHOOK_URL` - 企业微信Webhook地址

**检查方法**:
1. 访问: Settings → Secrets and variables → Actions
2. 检查这两个Secrets是否存在
3. 特别注意：**企业微信Webhook会定期失效**

**解决方法**:

#### 更新企业微信Webhook:
1. 打开企业微信群
2. 群设置 → 群机器人
3. 删除旧机器人（如果有）
4. 添加新机器人
5. 复制新的Webhook URL（格式: `https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=XXXXXXX`）
6. 在GitHub仓库中更新Secret `WECHAT_WEBHOOK_URL`

#### 更新GLM API密钥:
1. 访问 https://open.bigmodel.cn/
2. 控制台 → API Keys
3. 检查密钥是否有效
4. 如需要，创建新密钥并更新GitHub Secret `GLM_API_KEY`

---

### 原因3: GitHub Actions权限不足 🔐

**症状**:
- Workflow文件存在，但没有运行记录
- 或显示权限错误

**检查方法**:
1. 访问: Settings → Actions → General
2. 查看 "Workflow permissions" 设置

**解决方法**:
确保选择了 **"Read and write permissions"**

---

### 原因4: 仓库长期不活跃 💤

**症状**:
- GitHub可能会自动禁用长期不活跃仓库的定时Actions

**检查方法**:
查看Actions标签是否有禁用提示

**解决方法**:
重新启用Actions，或者提交一次代码更新

---

## ✅ 快速诊断步骤

### 步骤1: 检查Actions状态
```
访问: https://github.com/calvin-Yi3Wood/daily-news-digest/actions
查看:
  - Actions是否启用
  - 最近的运行记录
  - 是否有失败记录（红色×）
```

### 步骤2: 查看最新日志
如果有失败记录：
1. 点击最新的失败运行
2. 展开 "Run daily news digest" 步骤
3. 查看错误信息

### 步骤3: 手动触发测试
1. 访问: Actions → Daily News Digest
2. 点击右侧 "Run workflow" 按钮
3. 点击绿色 "Run workflow" 确认
4. 等待2-3分钟查看结果

---

## 🔧 解决方案优先级

### 🚨 优先级1 (立即检查)
1. **启用GitHub Actions** (如果被禁用)
2. **更新企业微信Webhook** (最常见失效原因)

### ⚠️ 优先级2 (如果优先级1无效)
3. **检查GLM API密钥**
4. **手动触发workflow测试**

### 💡 优先级3 (深度排查)
5. **检查Actions权限设置**
6. **查看详细错误日志**

---

## 📝 常见错误日志及解决方法

### 错误1: "认证失败" / "401 Unauthorized"
**原因**: API密钥过期或无效
**解决**: 更新 `GLM_API_KEY` Secret

### 错误2: "Webhook调用失败" / "Invalid webhook key"
**原因**: 企业微信Webhook失效
**解决**: 重新创建机器人并更新 `WECHAT_WEBHOOK_URL`

### 错误3: "No secrets found"
**原因**: GitHub Secrets未配置
**解决**: 在 Settings → Secrets 中添加必需的Secrets

---

## 🎯 推荐操作流程

### 方案A: 快速修复 (5分钟)
1. 访问GitHub Actions页面
2. 如果被禁用，启用Actions
3. 手动触发一次workflow测试
4. 检查企业微信是否收到推送

### 方案B: 深度修复 (15分钟)
1. 更新企业微信Webhook（创建新机器人）
2. 检查GLM API密钥余额和有效性
3. 更新GitHub Secrets
4. 手动触发workflow测试
5. 查看日志确认成功

---

## 📞 需要进一步诊断？

如果按照以上步骤仍无法解决，请提供以下信息：

1. **GitHub Actions状态截图**
   - Actions页面的状态
   - 最近运行记录（如果有）

2. **最新的错误日志**
   - 点击失败的workflow
   - 复制 "Run daily news digest" 步骤的日志

3. **Secrets配置确认**
   - 确认已配置 GLM_API_KEY
   - 确认已配置 WECHAT_WEBHOOK_URL

---

## 🔗 相关链接

- **GitHub仓库**: https://github.com/calvin-Yi3Wood/daily-news-digest
- **Actions页面**: https://github.com/calvin-Yi3Wood/daily-news-digest/actions
- **智谱AI控制台**: https://open.bigmodel.cn/
- **GitHub Actions文档**: https://docs.github.com/actions

---

**祝您顺利解决问题！如果需要进一步帮助，请随时联系。**
